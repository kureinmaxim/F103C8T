# Урок 2: UART-протокол и CRC — от строки к бинарному кадру

## 1) История идеи

- Сначала обычно делают текстовый обмен (ASCII-команды).
- Потом переходят к бинарному протоколу: компактнее, быстрее, меньше неоднозначностей.
- Чтобы защититься от шумов линии, добавляют CRC.

## 2) Как сделано у вас

- Командный канал: `USART1` (`PA9/PA10`, 38400, 8N1).
- Кадр: полезные байты + CRC16 (LSB first).
- Проверка CRC: `Core/Src/crc16.c`, функция `process_crc(..., true)`.

## 3) Принцип конца кадра

- В проекте используется межбайтный таймаут (`UART_TIMEOUT_MS` в `DataFile.h`).
- Если после последнего байта пауза больше таймаута — пакет считается завершенным.

## 4) Где смотреть код

- Прием и передача в очередь: `Core/Src/uart.c`
- Разбор команды и timeout/CRC: `Core/Src/main.c`, функция `Uart1Task`
- CRC16 алгоритм: `Core/Src/crc16.c`

## 5) Эволюция протокола (рекомендация)

1. Сейчас: timeout + CRC.
2. Следующий шаг: `SOF | LEN | CMD | PAYLOAD | CRC16`.
3. Далее: NACK-коды ошибок, версия протокола, расширяемые команды.

